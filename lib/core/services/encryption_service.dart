import 'dart:convert';
import 'dart:math';
import 'dart:typed_data';
import 'package:cryptography/cryptography.dart';
import 'package:crypto/crypto.dart' as crypto;
import 'package:flutter_secure_storage/flutter_secure_storage.dart';
import '../constants/app_constants.dart';

class EncryptionService {
  static final EncryptionService _instance = EncryptionService._internal();
  factory EncryptionService() => _instance;
  EncryptionService._internal();

  final FlutterSecureStorage _secureStorage = const FlutterSecureStorage();
  SecretKey? _masterKey;
  Uint8List? _salt;

  // Generate a random salt for the user
  Future<Uint8List> generateSalt() async {
    final random = Random.secure();
    final salt = Uint8List(32); // 256 bits
    for (int i = 0; i < salt.length; i++) {
      salt[i] = random.nextInt(256);
    }
    return salt;
  }

  // Generate a recovery key (24-word mnemonic)
  Future<String> generateRecoveryKey() async {
    final random = Random.secure();
    final words = <String>[];

    // TODO: Simple word list for demo - in production, use BIP39 word list
    final wordList = [
      'abandon',
      'ability',
      'able',
      'about',
      'above',
      'absent',
      'absorb',
      'abstract',
      'absurd',
      'abuse',
      'access',
      'accident',
      'account',
      'accuse',
      'achieve',
      'acid',
      'acoustic',
      'acquire',
      'across',
      'act',
      'action',
      'actor',
      'actress',
      'actual',
      'adapt',
      'add',
      'addict',
      'address',
      'adjust',
      'admit',
      'adult',
      'advance',
      'advice',
      'aerobic',
      'affair',
      'afford',
      'afraid',
      'again',
      'age',
      'agent',
      'agree',
      'ahead',
      'aim',
      'air',
      'airport',
      'aisle',
      'alarm',
      'album',
      'alcohol',
      'alert',
      'alien',
      'all',
      'alley',
      'allow',
      'almost',
      'alone',
      'alpha',
      'already',
      'also',
      'alter',
      'always',
      'amateur',
      'amazing',
      'among',
      'amount',
      'amused',
      'analyst',
      'anchor',
      'ancient',
      'anger',
      'angle',
      'angry',
      'animal',
      'ankle',
      'announce',
      'annual',
      'another',
      'answer',
      'antenna',
      'antique',
      'anxiety',
      'any',
      'apart',
      'apology',
      'appear',
      'apple',
      'approve',
      'april',
      'arch',
      'arctic',
      'area',
      'arena',
      'argue',
      'arm',
      'armed',
      'armor',
      'army',
      'around',
      'arrange',
      'arrest',
      'arrive',
      'arrow',
      'art',
      'artefact',
      'artist',
      'artwork',
      'ask',
      'aspect',
      'assault',
      'asset',
      'assist',
      'assume',
      'asthma',
      'athlete',
      'atom',
      'attack',
      'attend',
      'attitude',
      'attract',
      'auction',
      'audit',
      'august',
      'aunt',
      'author',
      'auto',
      'autumn',
      'average',
      'avocado',
      'avoid',
      'awake',
      'aware',
      'away',
      'awesome',
      'awful',
      'awkward',
      'axis',
      'baby',
      'bachelor',
      'bacon',
      'badge',
      'bag',
      'balance',
      'balcony',
      'ball',
      'bamboo',
      'banana',
      'banner',
      'bar',
      'barely',
      'bargain',
      'barrel',
      'base',
      'basic',
      'basket',
      'battle',
      'beach',
      'bean',
      'beauty',
      'because',
      'become',
      'beef',
      'before',
      'begin',
      'behave',
      'behind',
      'believe',
      'below',
      'belt',
      'bench',
      'benefit',
      'best',
      'betray',
      'better',
      'between',
      'beyond',
      'bicycle',
      'bid',
      'bike',
      'bind',
      'biology',
      'bird',
      'birth',
      'bitter',
      'black',
      'blade',
      'blame',
      'blanket',
      'blast',
      'bleak',
      'bless',
      'blind',
      'blood',
      'blossom',
      'blow',
      'blue',
      'blur',
      'blush',
      'board',
      'boat',
      'body',
      'boil',
      'bomb',
      'bone',
      'bonus',
      'book',
      'boost',
      'border',
      'boring',
      'borrow',
      'boss',
      'bottom',
      'bounce',
      'box',
      'boy',
      'bracket',
      'brain',
      'brand',
      'brass',
      'brave',
      'bread',
      'breeze',
      'brick',
      'bridge',
      'brief',
      'bright',
      'bring',
      'brisk',
      'broccoli',
      'broken',
      'bronze',
      'broom',
      'brother',
      'brown',
      'brush',
      'bubble',
      'buddy',
      'budget',
      'buffalo',
      'build',
      'bulb',
      'bulk',
      'bullet',
      'bundle',
      'bunker',
      'burden',
      'burger',
      'burst',
      'bus',
      'business',
      'busy',
      'butter',
      'buyer',
      'buzz',
      'cabbage',
      'cabin',
      'cable',
      'cactus',
      'cage',
      'cake',
      'call',
      'calm',
      'camera',
      'camp',
      'can',
      'canal',
      'cancel',
      'candy',
      'cannon',
      'canoe',
      'canvas',
      'canyon',
      'capable',
      'capital',
      'captain',
      'car',
      'carbon',
      'card',
      'care',
      'career',
      'careful',
      'careless',
      'cargo',
      'carpet',
      'carry',
      'cart',
      'case',
      'cash',
      'casino',
      'cast',
      'casual',
      'cat',
      'catalog',
      'catch',
      'category',
      'cattle',
      'caught',
      'cause',
      'caution',
      'cave',
      'ceiling',
      'celery',
      'cement',
      'census',
      'century',
      'cereal',
      'certain',
      'chair',
      'chalk',
      'champion',
      'change',
      'chaos',
      'charge',
      'chase',
      'cheap',
      'check',
      'cheese',
      'chef',
      'cherry',
      'chest',
      'chicken',
      'chief',
      'child',
      'chimney',
      'choice',
      'choose',
      'chronic',
      'chuckle',
      'chunk',
      'churn',
      'cigar',
      'cinnamon',
      'circle',
      'citizen',
      'city',
      'civil',
      'claim',
      'clamp',
      'clarify',
      'claw',
      'clay',
      'clean',
      'clerk',
      'clever',
      'click',
      'client',
      'cliff',
      'climb',
      'cling',
      'clinic',
      'clip',
      'clock',
      'clog',
      'close',
      'cloth',
      'cloud',
      'clown',
      'club',
      'clump',
      'cluster',
      'clutch',
      'coach',
      'coast',
      'coconut',
      'code',
      'coffee',
      'coil',
      'coin',
      'collect',
      'color',
      'column',
      'combine',
      'come',
      'comfort',
      'comic',
      'common',
      'company',
      'concert',
      'conduct',
      'confirm',
      'congress',
      'connect',
      'consider',
      'control',
      'convince',
      'cook',
      'cool',
      'copper',
      'copy',
      'coral',
      'core',
      'corn',
      'correct',
      'cost',
      'cotton',
      'couch',
      'country',
      'couple',
      'course',
      'cousin',
      'cover',
      'coyote',
      'crack',
      'cradle',
      'craft',
      'cram',
      'crane',
      'crash',
      'crater',
      'crawl',
      'crazy',
      'cream',
      'credit',
      'creek',
      'crew',
      'cricket',
      'crime',
      'crisp',
      'critic',
      'crop',
      'cross',
      'crouch',
      'crowd',
      'crucial',
      'cruel',
      'cruise',
      'crumble',
      'crunch',
      'crush',
      'cry',
      'crystal',
      'cube',
      'culture',
      'cup',
      'cupboard',
      'curious',
      'current',
      'curtain',
      'curve',
      'cushion',
      'custom',
      'cute',
      'cycle',
      'dad',
      'damage',
      'dance',
      'danger',
      'daring',
      'dash',
      'daughter',
      'dawn',
      'day',
      'deal',
      'debate',
      'debris',
      'decade',
      'december',
      'decide',
      'decline',
      'decorate',
      'decrease',
      'deer',
      'defense',
      'define',
      'defy',
      'degree',
      'delay',
      'deliver',
      'demand',
      'demise',
      'denial',
      'dentist',
      'deny',
      'depart',
      'depend',
      'deposit',
      'depth',
      'deputy',
      'derive',
      'describe',
      'desert',
      'design',
      'desk',
      'despair',
      'destroy',
      'detail',
      'detect',
      'develop',
      'device',
      'devote',
      'diagram',
      'dial',
      'diamond',
      'diary',
      'dice',
      'diesel',
      'diet',
      'differ',
      'digital',
      'dignity',
      'dilemma',
      'dinner',
      'dinosaur',
      'direct',
      'dirt',
      'disagree',
      'discover',
      'disease',
      'dish',
      'dismiss',
      'disorder',
      'display',
      'distance',
      'divert',
      'divide',
      'divorce',
      'dizzy',
      'doctor',
      'document',
      'dog',
      'doll',
      'dolphin',
      'domain',
      'donate',
      'donkey',
      'donor',
      'door',
      'dose',
      'double',
      'dove',
      'draft',
      'dragon',
      'drama',
      'drastic',
      'draw',
      'dream',
      'dress',
      'drift',
      'drill',
      'drink',
      'drip',
      'drive',
      'drop',
      'drum',
      'dry',
      'duck',
      'dumb',
      'dune',
      'during',
      'dust',
      'dutch',
      'duty',
      'dwarf',
      'dynamic',
      'eager',
      'eagle',
      'early',
      'earn',
      'earth',
      'easily',
      'east',
      'easy',
      'echo',
      'ecology',
      'economy',
      'edge',
      'edit',
      'educate',
      'effort',
      'egg',
      'eight',
      'either',
      'elbow',
      'elder',
      'electric',
      'elegant',
      'element',
      'elephant',
      'elevator',
      'elite',
      'else',
      'embark',
      'embody',
      'embrace',
      'emerge',
      'emotion',
      'employ',
      'empower',
      'empty',
      'enable',
      'enact',
      'end',
      'endless',
      'endorse',
      'enemy',
      'energy',
      'enforce',
      'engage',
      'engine',
      'enjoy',
      'enlist',
      'enough',
      'enrich',
      'enroll',
      'ensure',
      'enter',
      'entire',
      'entry',
      'envelope',
      'episode',
      'equal',
      'equip',
      'era',
      'erase',
      'erode',
      'erosion',
      'erratic',
      'error',
      'erupt',
      'escape',
      'essay',
      'essence',
      'estate',
      'eternal',
      'ethics',
      'evidence',
      'evil',
      'evoke',
      'evolve',
      'exact',
      'example',
      'excess',
      'exchange',
      'excite',
      'exclude',
      'excuse',
      'execute',
      'exercise',
      'exhaust',
      'exhibit',
      'exile',
      'exist',
      'exit',
      'exotic',
      'expand',
      'expect',
      'expire',
      'explain',
      'expose',
      'express',
      'extend',
      'extra',
      'eye',
      'eyebrow',
      'fabric',
      'face',
      'faculty',
      'fade',
      'faint',
      'faith',
      'fall',
      'false',
      'fame',
      'family',
      'famous',
      'fan',
      'fancy',
      'fantasy',
      'farm',
      'fashion',
      'fat',
      'fatal',
      'father',
      'fatigue',
      'fault',
      'favorite',
      'feature',
      'february',
      'federal',
      'fee',
      'feed',
      'feel',
      'female',
      'fence',
      'festival',
      'fetch',
      'fever',
      'few',
      'fiber',
      'fiction',
      'field',
      'figure',
      'file',
      'film',
      'filter',
      'final',
      'find',
      'fine',
      'finger',
      'finish',
      'fire',
      'firm',
      'first',
      'fiscal',
      'fish',
      'fitness',
      'fix',
      'flag',
      'flame',
      'flash',
      'flat',
      'flavor',
      'flee',
      'flight',
      'flip',
      'float',
      'flock',
      'floor',
      'flower',
      'fluid',
      'flush',
      'fly',
      'foam',
      'focus',
      'fog',
      'foil',
      'fold',
      'follow',
      'food',
      'foot',
      'force',
      'forest',
      'forget',
      'fork',
      'fortune',
      'forum',
      'forward',
      'fossil',
      'foster',
      'found',
      'fox',
      'fragile',
      'frame',
      'frequent',
      'fresh',
      'friend',
      'fringe',
      'frog',
      'front',
      'frost',
      'frown',
      'frozen',
      'fruit',
      'fuel',
      'fun',
      'funny',
      'furnace',
      'fury',
      'future',
      'gadget',
      'gain',
      'galaxy',
      'gallery',
      'game',
      'gap',
      'garage',
      'garbage',
      'garden',
      'garlic',
      'garment',
      'gas',
      'gasp',
      'gate',
      'gather',
      'gauge',
      'gaze',
      'general',
      'genius',
      'genre',
      'gentle',
      'genuine',
      'gesture',
      'ghost',
      'giant',
      'gift',
      'giggle',
      'ginger',
      'giraffe',
      'girl',
      'give',
      'glad',
      'glance',
      'glare',
      'glass',
      'glide',
      'glimpse',
      'globe',
      'gloom',
      'glory',
      'glove',
      'glow',
      'glue',
      'goat',
      'goddess',
      'gold',
      'good',
      'goose',
      'gorilla',
      'gospel',
      'gossip',
      'govern',
      'gown',
      'grab',
      'grace',
      'grain',
      'grant',
      'grape',
      'grass',
      'gravity',
      'great',
      'green',
      'grid',
      'grief',
      'grit',
      'grocery',
      'group',
      'grow',
      'grunt',
      'guard',
      'guess',
      'guide',
      'guilt',
      'guitar',
      'gun',
      'gym',
      'habit',
      'hair',
      'half',
      'hammer',
      'hamster',
      'hand',
      'happy',
      'harbor',
      'hard',
      'harsh',
      'harvest',
      'hash',
      'hate',
      'have',
      'hawk',
      'hazard',
      'head',
      'health',
      'heart',
      'heavy',
      'hedgehog',
      'height',
      'hello',
      'helmet',
      'help',
      'hen',
      'hero',
      'hidden',
      'high',
      'hill',
      'hint',
      'hip',
      'hire',
      'history',
      'hobby',
      'hockey',
      'hold',
      'hole',
      'holiday',
      'hollow',
      'home',
      'honey',
      'hood',
      'hope',
      'horn',
      'horror',
      'horse',
      'hospital',
      'host',
      'hotel',
      'hour',
      'hover',
      'hub',
      'huge',
      'human',
      'humble',
      'humor',
      'hundred',
      'hungry',
      'hunt',
      'hurdle',
      'hurry',
      'hurt',
      'husband',
      'hybrid',
      'ice',
      'icon',
      'idea',
      'identify',
      'idle',
      'ignore',
      'ill',
      'illegal',
      'illness',
      'image',
      'imitate',
      'immense',
      'immune',
      'impact',
      'impose',
      'improve',
      'impulse',
      'inch',
      'include',
      'income',
      'increase',
      'index',
      'indicate',
      'indoor',
      'industry',
      'infant',
      'inflict',
      'inform',
      'inhale',
      'inherit',
      'initial',
      'inject',
      'injury',
      'inmate',
      'inner',
      'innocent',
      'input',
      'inquiry',
      'insane',
      'insect',
      'inside',
      'inspire',
      'install',
      'intact',
      'interest',
      'into',
      'invest',
      'invite',
      'involve',
      'iron',
      'island',
      'isolate',
      'issue',
      'item',
      'ivory',
      'jacket',
      'jaguar',
      'jar',
      'jazz',
      'jealous',
      'jeans',
      'jelly',
      'jewel',
      'job',
      'join',
      'joke',
      'journey',
      'joy',
      'judge',
      'juice',
      'jump',
      'june',
      'jungle',
      'junior',
      'junk',
      'just',
      'kangaroo',
      'keen',
      'keep',
      'ketchup',
      'key',
      'kick',
      'kid',
      'kidney',
      'kind',
      'kingdom',
      'kiss',
      'kit',
      'kitchen',
      'kite',
      'kitten',
      'kiwi',
      'knee',
      'knife',
      'knock',
      'know',
      'lab',
      'label',
      'labor',
      'ladder',
      'lady',
      'lake',
      'lamp',
      'land',
      'large',
      'laser',
      'late',
      'latin',
      'laugh',
      'laundry',
      'lava',
      'law',
      'lawn',
      'lawsuit',
      'layer',
      'lazy',
      'leader',
      'leaf',
      'learn',
      'leave',
      'lecture',
      'left',
      'leg',
      'legal',
      'legend',
      'leisure',
      'lemon',
      'lend',
      'length',
      'lens',
      'leopard',
      'lesson',
      'letter',
      'level',
      'liar',
      'liberty',
      'library',
      'license',
      'life',
      'lift',
      'light',
      'like',
      'limb',
      'limit',
      'link',
      'lion',
      'liquid',
      'list',
      'little',
      'live',
      'lizard',
      'load',
      'loan',
      'lobster',
      'local',
      'lock',
      'logic',
      'lonely',
      'long',
      'loop',
      'lottery',
      'loud',
      'lounge',
      'love',
      'loyal',
      'lucky',
      'luggage',
      'lumber',
      'lunar',
      'lunch',
      'luxury',
      'lyrics',
      'machine',
      'mad',
      'magic',
      'magnet',
      'maid',
      'mail',
      'main',
      'major',
      'make',
      'mammal',
      'man',
      'manage',
      'mandate',
      'mango',
      'mansion',
      'manual',
      'maple',
      'marble',
      'march',
      'margin',
      'marine',
      'market',
      'marriage',
      'mask',
      'mass',
      'master',
      'match',
      'material',
      'math',
      'matrix',
      'matter',
      'maximum',
      'maze',
      'meadow',
      'mean',
      'measure',
      'meat',
      'mechanic',
      'medal',
      'media',
      'melody',
      'melt',
      'member',
      'memory',
      'mention',
      'menu',
      'mercy',
      'merge',
      'merit',
      'merry',
      'mesh',
      'message',
      'metal',
      'method',
      'middle',
      'midnight',
      'milk',
      'million',
      'mimic',
      'mind',
      'minimum',
      'minor',
      'minute',
      'miracle',
      'mirror',
      'misery',
      'miss',
      'mistake',
      'mix',
      'mixed',
      'mixture',
      'mobile',
      'model',
      'modify',
      'mom',
      'moment',
      'monitor',
      'monkey',
      'monster',
      'month',
      'mood',
      'moon',
      'moral',
      'more',
      'morning',
      'mosquito',
      'mother',
      'motion',
      'motor',
      'mountain',
      'mouse',
      'move',
      'movie',
      'much',
      'muffin',
      'mule',
      'multiply',
      'muscle',
      'museum',
      'mushroom',
      'music',
      'must',
      'mutual',
      'myself',
      'mystery',
      'myth',
      'naive',
      'name',
      'napkin',
      'narrow',
      'nasty',
      'nation',
      'nature',
      'near',
      'neck',
      'need',
      'negative',
      'neglect',
      'neither',
      'nephew',
      'nerve',
      'nest',
      'net',
      'network',
      'neutral',
      'never',
      'news',
      'next',
      'nice',
      'night',
      'noble',
      'noise',
      'nominee',
      'noodle',
      'normal',
      'north',
      'nose',
      'notable',
      'note',
      'nothing',
      'notice',
      'novel',
      'now',
      'nuclear',
      'number',
      'nurse',
      'nut',
      'oak',
      'obey',
      'object',
      'oblige',
      'obscure',
      'observe',
      'obtain',
      'obvious',
      'occur',
      'ocean',
      'october',
      'odor',
      'off',
      'offer',
      'office',
      'often',
      'oil',
      'okay',
      'old',
      'olive',
      'olympic',
      'omit',
      'once',
      'one',
      'onion',
      'online',
      'only',
      'open',
      'opera',
      'opinion',
      'oppose',
      'option',
      'orange',
      'orbit',
      'orchard',
      'order',
      'ordinary',
      'organ',
      'orient',
      'original',
      'orphan',
      'ostrich',
      'other',
      'outdoor',
      'outer',
      'outline',
      'outlook',
      'outrage',
      'outstanding',
      'oval',
      'oven',
      'over',
      'own',
      'owner',
      'oxygen',
      'oyster',
      'ozone',
      'pact',
      'paddle',
      'page',
      'pair',
      'palace',
      'palm',
      'panda',
      'panel',
      'panic',
      'panther',
      'paper',
      'parade',
      'parent',
      'park',
      'parrot',
      'party',
      'pass',
      'patch',
      'path',
      'patient',
      'patrol',
      'pattern',
      'pause',
      'pave',
      'payment',
      'peace',
      'peanut',
      'pear',
      'peasant',
      'pelican',
      'pen',
      'penalty',
      'pencil',
      'people',
      'pepper',
      'perfect',
      'permit',
      'person',
      'pet',
      'phone',
      'photo',
      'phrase',
      'physical',
      'piano',
      'picnic',
      'picture',
      'piece',
      'pig',
      'pigeon',
      'pill',
      'pilot',
      'pink',
      'pioneer',
      'pipe',
      'pistol',
      'pitch',
      'pizza',
      'place',
      'planet',
      'plastic',
      'plate',
      'play',
      'please',
      'pledge',
      'pluck',
      'plug',
      'plunge',
      'poem',
      'poet',
      'point',
      'polar',
      'pole',
      'police',
      'pond',
      'pony',
      'pool',
      'poor',
      'pop',
      'popcorn',
      'popular',
      'porch',
      'port',
      'portion',
      'portrait',
      'pose',
      'position',
      'possible',
      'post',
      'potato',
      'pottery',
      'poverty',
      'powder',
      'power',
      'practice',
      'praise',
      'predict',
      'prefer',
      'prepare',
      'present',
      'pretty',
      'prevent',
      'price',
      'pride',
      'primary',
      'print',
      'priority',
      'prison',
      'private',
      'prize',
      'problem',
      'process',
      'produce',
      'profit',
      'program',
      'project',
      'promote',
      'proof',
      'property',
      'prosper',
      'protect',
      'proud',
      'provide',
      'public',
      'pudding',
      'pull',
      'pulp',
      'pulse',
      'pumpkin',
      'punch',
      'pupil',
      'puppy',
      'purchase',
      'purity',
      'purpose',
      'purse',
      'push',
      'put',
      'puzzle',
      'pyramid',
      'quality',
      'quantum',
      'quarter',
      'question',
      'quick',
      'quit',
      'quiz',
      'quote',
      'rabbit',
      'raccoon',
      'race',
      'rack',
      'radar',
      'radio',
      'rail',
      'rain',
      'raise',
      'rally',
      'ramp',
      'ranch',
      'random',
      'range',
      'rapid',
      'rare',
      'rate',
      'rather',
      'raven',
      'raw',
      'razor',
      'ready',
      'real',
      'reason',
      'rebel',
      'rebuild',
      'recall',
      'receive',
      'recipe',
      'record',
      'recover',
      'recruit',
      'red',
      'reduce',
      'reflect',
      'reform',
      'refuse',
      'region',
      'regret',
      'regular',
      'reject',
      'relax',
      'release',
      'relief',
      'rely',
      'remain',
      'remember',
      'remind',
      'remove',
      'render',
      'renew',
      'rent',
      'reopen',
      'repair',
      'repeat',
      'replace',
      'reply',
      'report',
      'require',
      'rescue',
      'resemble',
      'resist',
      'resource',
      'response',
      'result',
      'retire',
      'retreat',
      'return',
      'reveal',
      'review',
      'reward',
      'rhythm',
      'rib',
      'ribbon',
      'rice',
      'rich',
      'ride',
      'ridge',
      'rifle',
      'right',
      'rigid',
      'ring',
      'riot',
      'ripple',
      'risk',
      'ritual',
      'rival',
      'river',
      'road',
      'roast',
      'robot',
      'robust',
      'rocket',
      'romance',
      'roof',
      'rookie',
      'room',
      'rose',
      'rotate',
      'rough',
      'round',
      'route',
      'row',
      'royal',
      'rubber',
      'rude',
      'rug',
      'rule',
      'run',
      'runway',
      'rural',
      'sad',
      'saddle',
      'sadness',
      'safe',
      'sail',
      'salad',
      'salmon',
      'salon',
      'salt',
      'salute',
      'same',
      'sample',
      'sand',
      'satisfy',
      'satoshi',
      'sauce',
      'sausage',
      'save',
      'say',
      'scale',
      'scan',
      'scare',
      'scatter',
      'scene',
      'scheme',
      'school',
      'science',
      'scissors',
      'scorpion',
      'scout',
      'scrap',
      'screen',
      'script',
      'scrub',
      'sea',
      'search',
      'season',
      'seat',
      'second',
      'secret',
      'section',
      'secure',
      'seed',
      'seek',
      'segment',
      'select',
      'sell',
      'seminar',
      'senior',
      'sense',
      'sentence',
      'series',
      'service',
      'session',
      'settle',
      'setup',
      'seven',
      'shadow',
      'shaft',
      'shallow',
      'share',
      'shed',
      'shell',
      'sheriff',
      'shield',
      'shift',
      'shine',
      'ship',
      'shiver',
      'shock',
      'shoe',
      'shoot',
      'shop',
      'shore',
      'short',
      'shoulder',
      'shove',
      'shrimp',
      'shrug',
      'shy',
      'sibling',
      'sick',
      'side',
      'siege',
      'sight',
      'sign',
      'silent',
      'silk',
      'silly',
      'silver',
      'similar',
      'simple',
      'since',
      'sing',
      'siren',
      'sister',
      'situate',
      'six',
      'size',
      'skate',
      'sketch',
      'ski',
      'skill',
      'skin',
      'skirt',
      'skull',
      'slab',
      'slam',
      'sleep',
      'slender',
      'slice',
      'slide',
      'slight',
      'slim',
      'slogan',
      'slot',
      'slow',
      'sluice',
      'slum',
      'slurp',
      'slush',
      'sly',
      'smack',
      'small',
      'smart',
      'smile',
      'smoke',
      'smooth',
      'smug',
      'snack',
      'snake',
      'snap',
      'snare',
      'snarl',
      'sneak',
      'sneeze',
      'sniff',
      'snore',
      'snort',
      'snout',
      'snow',
      'snub',
      'snuff',
      'snug',
      'soak',
      'soap',
      'soar',
      'sob',
      'soccer',
      'social',
      'sock',
      'soda',
      'sofa',
      'soft',
      'soggy',
      'soil',
      'solar',
      'soldier',
      'solid',
      'solo',
      'solve',
      'someone',
      'song',
      'soon',
      'sorry',
      'sort',
      'soul',
      'sound',
      'soup',
      'sour',
      'south',
      'space',
      'spare',
      'spark',
      'spatula',
      'spawn',
      'speak',
      'speed',
      'spell',
      'spend',
      'sphere',
      'spice',
      'spider',
      'spike',
      'spin',
      'spirit',
      'split',
      'spoil',
      'sponsor',
      'spoon',
      'sport',
      'spot',
      'spray',
      'spread',
      'spring',
      'spy',
      'square',
      'squeeze',
      'squirrel',
      'stable',
      'stadium',
      'staff',
      'stage',
      'stairs',
      'stamp',
      'stand',
      'start',
      'state',
      'stay',
      'steak',
      'steel',
      'stem',
      'step',
      'stereo',
      'stick',
      'still',
      'sting',
      'stink',
      'stir',
      'stock',
      'stomach',
      'stone',
      'stool',
      'stoop',
      'stop',
      'store',
      'storm',
      'story',
      'stove',
      'straddle',
      'straight',
      'strand',
      'strange',
      'stranger',
      'strap',
      'straw',
      'stray',
      'stream',
      'street',
      'stress',
      'stretch',
      'strict',
      'stride',
      'strike',
      'string',
      'strive',
      'stroke',
      'stroll',
      'strong',
      'struggle',
      'strut',
      'stuck',
      'study',
      'stuff',
      'stump',
      'stung',
      'stunned',
      'stunt',
      'style',
      'subdue',
      'subject',
      'submit',
      'subway',
      'success',
      'such',
      'sudden',
      'suffer',
      'sugar',
      'suggest',
      'suit',
      'sulky',
      'summer',
      'sun',
      'sunny',
      'sunset',
      'super',
      'supply',
      'supreme',
      'sure',
      'surface',
      'surge',
      'surprise',
      'surround',
      'survey',
      'suspect',
      'sustain',
      'swallow',
      'swamp',
      'swap',
      'swarm',
      'sway',
      'swear',
      'sweet',
      'swift',
      'swim',
      'swing',
      'switch',
      'sword',
      'sworn',
      'swung',
      'syllable',
      'symbol',
      'symptom',
      'syndicate',
      'synergy',
      'syntax',
      'synthetic',
      'syrup',
      'system',
      'tab',
      'table',
      'tablet',
      'tack',
      'tackle',
      'tact',
      'tadpole',
      'tag',
      'tail',
      'take',
      'tale',
      'talk',
      'tall',
      'tame',
      'tan',
      'tank',
      'tap',
      'tape',
      'target',
      'task',
      'taste',
      'tattoo',
      'tax',
      'taxi',
      'tea',
      'teach',
      'team',
      'tear',
      'tease',
      'teen',
      'teenager',
      'teeth',
      'telephone',
      'tell',
      'ten',
      'tenant',
      'tend',
      'tender',
      'tennis',
      'tent',
      'term',
      'test',
      'text',
      'thank',
      'that',
      'the',
      'theater',
      'theft',
      'their',
      'them',
      'theme',
      'then',
      'theory',
      'there',
      'they',
      'thick',
      'thief',
      'thigh',
      'thin',
      'thing',
      'think',
      'third',
      'thirst',
      'thirteen',
      'thirty',
      'this',
      'thorough',
      'those',
      'though',
      'thought',
      'thousand',
      'thread',
      'threat',
      'three',
      'threw',
      'thrill',
      'thrive',
      'throat',
      'through',
      'throw',
      'thrust',
      'thumb',
      'thump',
      'thunder',
      'thus',
      'tick',
      'ticket',
      'tide',
      'tidy',
      'tie',
      'tiger',
      'tight',
      'tile',
      'till',
      'tilt',
      'timber',
      'time',
      'timid',
      'tin',
      'tiny',
      'tip',
      'tire',
      'tired',
      'tissue',
      'title',
      'to',
      'toast',
      'today',
      'toe',
      'together',
      'toilet',
      'token',
      'tomato',
      'tomorrow',
      'tone',
      'tongue',
      'tonight',
      'too',
      'took',
      'tool',
      'tooth',
      'top',
      'topic',
      'topple',
      'torch',
      'tornado',
      'tortoise',
      'toss',
      'total',
      'touch',
      'tough',
      'tour',
      'toward',
      'towel',
      'tower',
      'town',
      'toy',
      'trace',
      'track',
      'trade',
      'traffic',
      'tragic',
      'train',
      'transfer',
      'trap',
      'trash',
      'travel',
      'tray',
      'treat',
      'tree',
      'trend',
      'trial',
      'tribe',
      'trick',
      'trigger',
      'trim',
      'trip',
      'triumph',
      'trolley',
      'trophy',
      'trouble',
      'truck',
      'true',
      'truly',
      'trumpet',
      'trust',
      'truth',
      'try',
      'tube',
      'tuck',
      'tuesday',
      'tug',
      'tuition',
      'tulip',
      'tumble',
      'tuna',
      'tune',
      'tunnel',
      'turbo',
      'turkey',
      'turn',
      'turtle',
      'twelve',
      'twenty',
      'twice',
      'twin',
      'twist',
      'two',
      'type',
      'typical',
      'ugly',
      'umbrella',
      'unable',
      'unaware',
      'uncle',
      'uncover',
      'under',
      'undo',
      'unfair',
      'unfold',
      'unhappy',
      'unhealthy',
      'uniform',
      'unique',
      'unit',
      'universe',
      'unknown',
      'unlock',
      'until',
      'unusual',
      'unveil',
      'unwind',
      'unwise',
      'up',
      'update',
      'upgrade',
      'uphold',
      'upon',
      'upper',
      'upset',
      'urban',
      'urge',
      'urgent',
      'usage',
      'use',
      'used',
      'useful',
      'useless',
      'user',
      'usual',
      'utility',
      'vacant',
      'vacuum',
      'vague',
      'vain',
      'valid',
      'valley',
      'valve',
      'van',
      'vanish',
      'vanity',
      'vapor',
      'various',
      'vast',
      'vault',
      'vehicle',
      'velvet',
      'vendor',
      'venom',
      'venture',
      'venue',
      'verb',
      'verify',
      'version',
      'very',
      'vessel',
      'veteran',
      'viable',
      'vibrant',
      'vicious',
      'victory',
      'video',
      'view',
      'village',
      'vintage',
      'violin',
      'viral',
      'virtual',
      'virus',
      'visa',
      'visit',
      'visual',
      'vital',
      'vivid',
      'vocal',
      'voice',
      'void',
      'volcano',
      'volume',
      'vote',
      'voyage',
      'wage',
      'wagon',
      'wait',
      'wake',
      'walk',
      'wall',
      'walnut',
      'want',
      'war',
      'warehouse',
      'warm',
      'warn',
      'warrant',
      'warrior',
      'wash',
      'wasp',
      'waste',
      'water',
      'wave',
      'way',
      'weak',
      'wealth',
      'weapon',
      'wear',
      'weasel',
      'weather',
      'web',
      'wedding',
      'weed',
      'week',
      'weird',
      'welcome',
      'west',
      'wet',
      'whale',
      'what',
      'wheat',
      'wheel',
      'when',
      'where',
      'whip',
      'whisper',
      'white',
      'who',
      'whole',
      'whom',
      'whose',
      'why',
      'wicked',
      'wide',
      'widow',
      'width',
      'wife',
      'wild',
      'will',
      'win',
      'window',
      'wine',
      'wing',
      'wink',
      'winner',
      'winter',
      'wire',
      'wisdom',
      'wise',
      'wish',
      'wisp',
      'wit',
      'witch',
      'with',
      'withdraw',
      'within',
      'without',
      'witness',
      'wolf',
      'woman',
      'wonder',
      'wood',
      'wool',
      'word',
      'work',
      'world',
      'worry',
      'worth',
      'would',
      'wound',
      'wrap',
      'wreck',
      'wrestle',
      'wrist',
      'write',
      'wrong',
      'wrote',
      'wrung',
      'wry',
      'yacht',
      'yard',
      'yarn',
      'yawn',
      'year',
      'yellow',
      'yes',
      'yesterday',
      'yet',
      'yield',
      'yoga',
      'yoke',
      'young',
      'youth',
      'zebra',
      'zero',
      'zone',
      'zoo',
      'zoom',
      'zucchini',
      'zulu',
      'zombie',
    ];

    for (int i = 0; i < 24; i++) {
      words.add(wordList[random.nextInt(wordList.length)]);
    }

    return words.join(' ');
  }

  // Derive master key from master password and salt using PBKDF2
  Future<SecretKey> deriveMasterKey(
    String masterPassword,
    Uint8List salt,
  ) async {
    final pbkdf2 = Pbkdf2(
      macAlgorithm: Hmac.sha256(),
      iterations: AppConstants.pbkdf2Iterations,
      bits: AppConstants.keyLength,
    );

    return await pbkdf2.deriveKey(
      secretKey: SecretKey(utf8.encode(masterPassword)),
      nonce: salt,
    );
  }

  // Encrypt credential data
  Future<Map<String, String>> encryptCredential(
    Map<String, dynamic> credential,
    SecretKey key,
  ) async {
    final algorithm = AesGcm.with256bits();
    final nonce = algorithm.newNonce();

    final secretBox = await algorithm.encrypt(
      utf8.encode(jsonEncode(credential)),
      secretKey: key,
      nonce: nonce,
    );

    return {
      'encrypted_data': base64Encode(secretBox.cipherText),
      'nonce': base64Encode(secretBox.nonce),
      'mac': base64Encode(secretBox.mac.bytes),
    };
  }

  // Decrypt credential data
  Future<Map<String, dynamic>> decryptCredential(
    String encryptedData,
    String nonceStr,
    String macStr,
    SecretKey key,
  ) async {
    final algorithm = AesGcm.with256bits();

    final secretBox = SecretBox(
      base64Decode(encryptedData),
      nonce: base64Decode(nonceStr),
      mac: Mac(base64Decode(macStr)),
    );

    final decrypted = await algorithm.decrypt(secretBox, secretKey: key);

    return jsonDecode(utf8.decode(decrypted));
  }

  // Encrypt recovery key with master password
  Future<String> encryptRecoveryKey(String recoveryKey, SecretKey key) async {
    final algorithm = AesGcm.with256bits();
    final nonce = algorithm.newNonce();

    final secretBox = await algorithm.encrypt(
      utf8.encode(recoveryKey),
      secretKey: key,
      nonce: nonce,
    );

    final encrypted = {
      'data': base64Encode(secretBox.cipherText),
      'nonce': base64Encode(secretBox.nonce),
      'mac': base64Encode(secretBox.mac.bytes),
    };

    return base64Encode(utf8.encode(jsonEncode(encrypted)));
  }

  // Decrypt recovery key with master password
  Future<String> decryptRecoveryKey(
    String encryptedRecoveryKey,
    SecretKey key,
  ) async {
    final algorithm = AesGcm.with256bits();

    final encryptedData = jsonDecode(
      utf8.decode(base64Decode(encryptedRecoveryKey)),
    );

    final secretBox = SecretBox(
      base64Decode(encryptedData['data']),
      nonce: base64Decode(encryptedData['nonce']),
      mac: Mac(base64Decode(encryptedData['mac'])),
    );

    final decrypted = await algorithm.decrypt(secretBox, secretKey: key);

    return utf8.decode(decrypted);
  }

  // Derive key from recovery key (simplified for demo)
  Future<SecretKey> deriveKeyFromRecoveryKey(String recoveryKey) async {
    // TODO: In production, use proper BIP39 derivation
    final hash = crypto.sha256.convert(utf8.encode(recoveryKey));
    return SecretKey(hash.bytes);
  }

  // Store master key hash securely
  Future<void> storeMasterKeyHash(String masterPassword) async {
    final hash = crypto.sha256.convert(utf8.encode(masterPassword));
    await _secureStorage.write(
      key: AppConstants.masterPasswordKey,
      value: hash.toString(),
    );
  }

  // Verify master password
  Future<bool> verifyMasterPassword(String masterPassword) async {
    final storedHash = await _secureStorage.read(
      key: AppConstants.masterPasswordKey,
    );
    if (storedHash == null) return false;

    final hash = crypto.sha256.convert(utf8.encode(masterPassword));
    return storedHash == hash.toString();
  }

  // Store salt securely
  Future<void> storeSalt(Uint8List salt) async {
    await _secureStorage.write(
      key: AppConstants.saltKey,
      value: base64Encode(salt),
    );
  }

  // Get stored salt
  Future<Uint8List?> getStoredSalt() async {
    final saltStr = await _secureStorage.read(key: AppConstants.saltKey);
    if (saltStr == null) return null;
    return base64Decode(saltStr);
  }

  // Clear all stored data
  Future<void> clearAllData() async {
    await _secureStorage.deleteAll();
    _masterKey = null;
    _salt = null;
  }

  // Set master key for current session
  void setMasterKey(SecretKey key) {
    _masterKey = key;
  }

  // Get current master key
  SecretKey? getMasterKey() {
    return _masterKey;
  }

  // Set salt for current session
  void setSalt(Uint8List salt) {
    _salt = salt;
  }

  // Get current salt
  Uint8List? getSalt() {
    return _salt;
  }

  // Generate random password
  String generatePassword({
    int length = 16,
    bool includeUppercase = true,
    bool includeLowercase = true,
    bool includeNumbers = true,
    bool includeSymbols = true,
    bool excludeAmbiguous = true,
  }) {
    final random = Random.secure();
    String chars = '';

    if (includeLowercase) chars += 'abcdefghijklmnopqrstuvwxyz';
    if (includeUppercase) chars += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    if (includeNumbers) chars += '0123456789';
    if (includeSymbols) chars += '!@#\$%^&*()_+-=[]{}|;:,.<>?';

    if (excludeAmbiguous) {
      chars = chars.replaceAll(RegExp(r'[0O1lI]'), '');
    }

    if (chars.isEmpty) chars = 'abcdefghijklmnopqrstuvwxyz';

    return List.generate(
      length,
      (index) => chars[random.nextInt(chars.length)],
    ).join('');
  }

  // Generate pronounceable password
  String generatePronounceablePassword({int length = 16}) {
    final random = Random.secure();
    final vowels = 'aeiou';
    final consonants = 'bcdfghjklmnpqrstvwxyz';

    String password = '';
    bool isVowel = random.nextBool();

    for (int i = 0; i < length; i++) {
      if (isVowel) {
        password += vowels[random.nextInt(vowels.length)];
      } else {
        password += consonants[random.nextInt(consonants.length)];
      }
      isVowel = !isVowel;
    }

    return password;
  }
}
